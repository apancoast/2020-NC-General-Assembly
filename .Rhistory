}
### GET PAGES OF CANDIDATES ###
candidate_pages <- tibble(page_num = 1:8)
candidate_pages <- candidate_pages %>%
mutate(page = paste0("https://www.transparencyusa.org/nc/candidates?cycle=2020-election-cycle&by=candidateOfficeHeld&order=desc", page_num))
#scrap districts
candidates <- candidate_pages %>%
mutate(district = map(links, get_district))
page <- read_html(page)
candidate_pages <- tibble(page_num = 1:8)
candidate_pages <- candidate_pages %>%
mutate(page = paste0("https://www.transparencyusa.org/nc/candidates?cycle=2020-election-cycle&by=candidateOfficeHeld&order=desc", page_num))
### GET CANDIDATE'S PAGES ###
get_candidates <- function(page) {
page <- read_html(page)
page %>%
html_nodes(".table-hover a") %>%
html_attr("href") %>%
as_tibble() %>%
transmute(links = paste0("https://www.transparencyusa.org", value, "/donors?by=donorTypeCode", sep=""))
}
#Scrape candidate links
candidate_pages <- candidate_pages %>%
mutate(links = map(page, get_candidates))
candidate_pages <- candidate_pages %>%
unnest(links)
get_district = function(links) {
links <- read_html(links)
links %>%
html_nodes(".profile-subtitle span") %>%
html_text() %>%
as_tibble() %>%
rename("district" = "value")
}
#scrap districts
candidates <- candidate_pages %>%
mutate(district = map(links, get_district))
candidate_pages <- candidates %>%
unnest(district)
library(tidyverse)
# Exploring Donors ----
donors <- read.csv("donors.csv")
#let's get that table real purrrty
donors %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
)
library(rvest)
link <- "https://ballotpedia.org/North_Carolina_House_of_Representatives"
page <- read_html(link)
house_district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
rep <- page %>% html_nodes("#officeholder-table td:nth-child(2)") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
nc_state_house <- data.frame(house_district, rep, term_start, stringsAsFactors = FALSE)
View(nc_state_house)
write.csv(ga_house, "ga_house.csv")
ga_house <- data.frame(house_district, rep, term_start, stringsAsFactors = FALSE)
write.csv(ga_house, "ga_house.csv")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv")
View(nc_state_house)
View(house)
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(distict = paste("North Carolina House of Representatives District", district))
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
View(house)
senate <- csv.read("senate_NCGA.csv")
##Scrapping NC state house rep terms
link <- "https://ballotpedia.org/North_Carolina_House_of_Representatives"
library(tidyverse)
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/S
senate <- read.csv("senate_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
View(senate)
link <- "https://ballotpedia.org/North_Carolina_State_Senate"
page <- read_html(link)
senate_district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
ga_senate <- data.frame(senate_district, term_start, stringsAsFactors = FALSE)
write.csv(ga_senate, "ga_senate.csv")
View(ga_senate)
ga_house_terms <- data.frame(house_district, rep, term_start, stringsAsFactors = FALSE)
ga_house_terms <- data.frame(house_district, rep, term_start, stringsAsFactors = FALSE)
library(rvest)
ga_house_terms <- data.frame(house_district, rep, term_start, stringsAsFactors = FALSE)
ga_house_terms <- tibble(house_district, rep, term_start, stringsAsFactors = FALSE)
link <- "https://ballotpedia.org/North_Carolina_House_of_Representatives"
page <- read_html(link)
house_district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
rep <- page %>% html_nodes("#officeholder-table td:nth-child(2)") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
ga_house_terms <- tibble(house_district, rep, term_start, stringsAsFactors = FALSE)
write.csv(ga_house_terms, "ga_house_terms.csv")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#join
house <- full_join(house,ga_house_terms,by="house_district")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
house_district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
house <- read.csv("house_NCGA.csv")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
house_district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
house_district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", house_district))
#join
house <- full_join(house, ga_house_terms,by="house_district")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
house_district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(house_district = paste("North Carolina House of Representatives District", house_district))
#join
house <- full_join(house, ga_house_terms,by="house_district")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#join
house <- full_join(house, ga_house_terms,by="district")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/S
senate <- read.csv("senate_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Senate District", district))
View(ga_house)
link <- "https://ballotpedia.org/North_Carolina_State_Senate"
page <- read_html(link)
district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
ga_senate_terms <- data.frame(district, term_start, stringsAsFactors = FALSE)
write.csv(ga_senate_terms, "ga_senate_terms.csv")
#join
senate <- full_join(senate,ga_senate_terms,by="district")
View(senate)
View(senate)
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/S
senate <- read.csv("senate_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina Senate District", district))
link <- "https://ballotpedia.org/North_Carolina_State_Senate"
page <- read_html(link)
district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
ga_senate_terms <- data.frame(district, term_start, stringsAsFactors = FALSE)
write.csv(ga_senate_terms, "ga_senate_terms.csv")
#join
senate <- full_join(senate,ga_senate_terms,by="district")
View(senate)
#### STATE SENATORS ####
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/S
senate <- read.csv("senate_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina State Senate District", district))
#scrapping for term from https://ballotpedia.org/North_Carolina_State_Senate
link <- "https://ballotpedia.org/North_Carolina_State_Senate"
page <- read_html(link)
district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
ga_senate_terms <- data.frame(district, term_start, stringsAsFactors = FALSE)
write.csv(ga_senate_terms, "ga_senate_terms.csv")
#join
senate <- full_join(senate,ga_senate_terms,by="district")
View(house)
link <- "https://ballotpedia.org/North_Carolina_House_of_Representatives"
page <- read_html(link)
house_district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
rep <- page %>% html_nodes("#officeholder-table td:nth-child(2)") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
ga_house_terms <- tibble(house_district, rep, term_start, stringsAsFactors = FALSE)
write.csv(ga_house_terms, "ga_house_terms.csv")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#join
house <- full_join(house, ga_house_terms,by="district")
district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
ga_house_terms <- tibble(district, rep, term_start, stringsAsFactors = FALSE)
write.csv(ga_house_terms, "ga_house_terms.csv")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#join
house <- full_join(house, ga_house_terms,by="district")
View(house)
ga_house_terms <- tibble(district, term_start)
link <- "https://ballotpedia.org/North_Carolina_House_of_Representatives"
page <- read_html(link)
district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
ga_house_terms <- tibble(district, term_start)
write.csv(ga_house_terms, "ga_house_terms.csv")
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#join
house <- full_join(house, ga_house_terms,by="district")
#### STATE SENATORS ####
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/S
senate <- read.csv("senate_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina State Senate District", district))
#scrapping for term from https://ballotpedia.org/North_Carolina_State_Senate
link <- "https://ballotpedia.org/North_Carolina_State_Senate"
page <- read_html(link)
district <- page %>% html_nodes("#officeholder-table td:nth-child(1) a") %>% html_text()
term_start <- page %>% html_nodes("#officeholder-table td:nth-child(4)") %>% html_text()
ga_senate_terms <- tibble(district, term_start)
write.csv(ga_senate_terms, "ga_senate_terms.csv")
#join
senate <- full_join(senate,ga_senate_terms,by="district")
#join senate and house
nc_ga_2020_elected <- bind_rows(senate, house)
View(nc_ga_2020_elected)
#join senate and house
nc_ga_2020_elected <- bind_rows(senate, house) %>%
str_trim(side = "both")
View(nc_state_house)
nc_ga_2020_elected <- bind_rows(senate, house)
View(nc_ga_2020_elected)
#join senate and house
nc_ga_2020_elected <- bind_rows(senate, house) %>%
mutate(counties = gsub("\\s+", " ", counties))
View(nc_ga_2020_elected)
#join senate and house
nc_ga_2020_elected <- bind_rows(senate, house) %>%
mutate(counties = gsub("\\s+", "", counties))
#join senate and house
nc_ga_2020_elected <- bind_rows(senate, house) %>%
mutate(counties = gsub("\\s+", "", counties),
member = gsub("\\s+", "", member))
#join senate and house
nc_ga_2020_elected <- bind_rows(senate, house) %>%
mutate(counties = gsub("\\s+", "", counties),
member = gsub("\\s+", " ", member))
nc_ga_2020_elected %>% write.csv("nc_ga_2020_elected.csv")
#let's get that table real purrrty
donors %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
)
View(donors)
#let's get that table real purrrty
donors %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(donations_total = as.numeric(gsub("[\\$,]", "", donations_total)))
#let's get that table real purrrty
donors %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(donations_total = as.numeric(gsub("[\\$,]", "")))
#let's get that table real purrrty
donors %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "\u00e1"))
# Exploring Donors ----
#let's get that table real purrrty
donors <- read.csv("donors.csv") %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "\u00e1"))
# Exploring Donors ----
#let's get that table real purrrty
donors <- read.csv("donors.csv") %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = ""))
# Exploring Donors ----
#let's get that table real purrrty
donors <- read.csv("donors.csv") %>%
select( -matches(X)) %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = ""))
# Exploring Donors ----
#let's get that table real purrrty
donors <- read.csv("donors.csv") %>%
select( -matches("X")) %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = ""))
# Exploring Donors ----
#let's get that table real purrrty
read.csv("nc_ga_2020_elected.csv")
# Exploring Donors ----
#let's get that table real purrrty
nc_ga_2020_elected <- read.csv("nc_ga_2020_elected.csv")
donors <- read.csv("donors.csv") %>%
select( -matches("X")) %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "")) %>%
left_join(nc_ga_2020_elected)
View(donors)
donors <- read.csv("donors.csv") %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "")) %>%
left_join(nc_ga_2020_elected) %>%
select( -matches("X"))
donors <- read.csv("donors.csv") %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "")) %>%
select( -matches("X")) %>%
left_join(nc_ga_2020_elected) %>%
select( -matches("X"))
donors <- read.csv("donors.csv")
# Exploring Donors ----
#let's get that table real purrrty
nc_ga_2020_elected <- read.csv("nc_ga_2020_elected.csv")
donors <- read.csv("donors.csv") %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "")) %>%
select( -matches("X")) %>%
left_join(nc_ga_2020_elected) %>%
select( -matches("X"))
donors <- read.csv("donors.csv") %>%
select( -matches("X")) %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "")) %>%
left_join(nc_ga_2020_elected) %>%
select( -matches("X"))
#gotta clean entity donors
entity_donors <- donors %>%
filter(donor_type == "ENTITY") %>%
select(district,member,tot_from_donor,donor_name)
summary(entity_donors)
donors <- read.csv("donors.csv") %>%
select( -matches("X")) %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "")) %>%
left_join(nc_ga_2020_elected) %>%
select( -matches("X")) %>%
mutate(tot_to_candidate = (as.numeric()))
donors <- read.csv("donors.csv") %>%
select( -matches("X")) %>%
rename(tot_to_candidate = donations_total,
tot_from_donor = Total.Donations..Click.to.sort.Ascending.,
donor_name = Donor..Click.to.sort.Ascending.,
donor_type = Type..Click.to.sort.Descending.
) %>%
mutate(across(everything(), gsub, pattern = "[\\$,]", replacement = "")) %>%
left_join(nc_ga_2020_elected) %>%
select( -matches("X")) %>%
mutate(tot_to_candidate = as.numeric(tot_to_candidate),
tot_from_donor = as.numeric(tot_from_donor)
)
#gotta clean entity donors
entity_donors <- donors %>%
filter(donor_type == "ENTITY") %>%
select(district,member,tot_from_donor,donor_name)
summary(entity_donors)
View(entity_donors)
entity_donors %>%
distinct(donor_name)
#gotta clean entity donors
entity_donors <- donors %>%
filter(donor_type == "ENTITY") %>%
select(district,member,tot_from_donor,donor_name) %>%
arrange(desc(donor_name))
#gotta clean entity donors
entity_donors <- donors %>%
filter(donor_type == "ENTITY") %>%
select(district,member,tot_from_donor,donor_name) %>%
arrange(donor_name)
View(entity_donors)
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("/CSVs/house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("~/state_congress/CSVs/house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("~RStudio/state_congress/CSVs/house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
#exported from the State's website: https://www.ncleg.gov/Members/MemberTable/H
house <- read.csv("~/RStudio/state_congress/CSVs/house_NCGA.csv") %>%
rename(party = Party,
district = District,
member = Member,
counties = Counties.Represented) %>%
mutate(district = paste("North Carolina House of Representatives District", district))
